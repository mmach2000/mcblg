---
import { getCollection } from 'astro:content';
import StarlightPage from '@astrojs/starlight/components/StarlightPage.astro';

import { IS_DEV } from '../utils/constants';
import { PostsPage } from '@/components/react/PostsPage';
import { getAllTags, getCategory, getMetadata } from '@/utils/content';

export const prerender = false;
const url = Astro.request.url;

const allNotes = (await getCollection('docs' as const, ({ slug, data }) => getCategory(slug) === '/series' && (IS_DEV || !data.draft)));
const tags = getAllTags(allNotes);
const trimmedPosts = await Promise.all(allNotes.map(getMetadata));

const frontmatter = {
  title: 'SERIES',
  tableOfContents: false,
  noFooter: true,
};
---

<StarlightPage frontmatter={frontmatter} hasSidebar={false}>
  <PostsPage tags={tags} posts={trimmedPosts} initialUrl={url} client:load />
</StarlightPage>
